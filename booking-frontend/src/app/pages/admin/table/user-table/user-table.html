<div class="m-5">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-2xl font-bold">Account Manager</h2>
      <button (click)="openAdd()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">+ New User</button>
    </div>

    <div class="p-4 mb-4 border rounded-md bg-white shadow-sm">
      <app-search></app-search>
    </div>

    <p-table class="w-full table-auto" [value]="(account | async) || []">
        <ng-template #header>
            <tr>
                <th>Action</th>
                <th>Name</th>
                <th>Email</th>
                <th>Role</th>
                <th>Phone</th>
                <th>Address</th>
            </tr>
        </ng-template>
        <ng-template #body let-account>
            <tr>
                <td class="px-4 py-2 text-center">
                  <button (click)="toggleDropdown(account.id)" class="relative bg-green-600 text-white px-2 py-1 rounded"> 
                    <i class="fa-solid fa-gear"></i>
                    Actions
                  </button>
                  <div *ngIf="dropdownOpen === account.id" class="absolute left-0 mt-1 bg-white border border-gray-300 rounded shadow w-40 z-1000">
                    <ul>
                      <li class="p-3 hover:bg-gray-100 cursor-pointer">View detail</li>
                      <li class="p-3 hover:bg-gray-100 cursor-pointer" (click)="openEdit(account)">Edit</li>
                      <li class="p-3 hover:bg-gray-100 cursor-pointer">Delete</li>
                      <li class="p-3 hover:bg-gray-100 cursor-pointer">Lock</li>
                      <li class="p-3 hover:bg-gray-100 cursor-pointer" (click)="openPermissionsModal()">Permissions</li>
                      <li class="p-3 hover:bg-gray-100 cursor-pointer">Set pasword</li>
                    </ul>
                  </div>
                </td>
                <td>{{ account.userName }}</td>
                <td>{{ account.email }}</td>
                <td>
                  <span *ngFor="let r of account.userRoles; let last = last">
                    {{ r.role.name }}<span *ngIf="!last">,</span>
                  </span>
                </td>
                <td>{{ account.phone }}</td>
                <td>{{ account.address }}</td>
            </tr>
        </ng-template>
    </p-table>
</div><ng-container *ngIf="showModal">
  <app-permissions-modal
    [permissionGroups]="permissionGroups"
    [groupedPermissions]="groupedPermissions"
    (cancel)="showModal = false">
  </app-permissions-modal>
</ng-container>

<app-modal-form
  *ngIf="showModalForm"
  [title]="modalTitle"
  [fields]="modalFields"
  [formData]="currentCategory"
  (save)="onSave($event)"
  (close)="showModalForm=false"
></app-modal-form>